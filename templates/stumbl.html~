<!DOCTYPE>
<html>
	<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">

		<title>Stumblr</title>

		<link rel="stylesheet" href="/static/css/bootstrap.css" type="text/css" media="screen" title="master" charset="utf-8">
		<link rel="stylesheet" href="/static/css/bootstrap-responsive.css" type="text/css" media="screen" title="master" charset="utf-8">
        <script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.5.1.min.js"></script>
        <script type='text/javascript' src="/static/script.js"></script>
	    <script src="/static/jquery.js"></script>

  <div id="fb-root"></div>
	<script>
          // globals
          var data;

	  // Additional JS functions here
	  window.fbAsyncInit = function() {
	    FB.init({
	      appId      : '290104991112550', // App ID
	      channelUrl : 'http://app-stumblr.rhcloud.com/stumbl',  // Channel File

	      status     : true, // check login status
	      cookie     : true, // enable cookies to allow the server to access the session
	      xfbml      : true  // parse XFBML
	    });
            
	    // Additional init code here
	    FB.getLoginStatus(function(response) {

                 // connected
	         if (response.status === 'connected') {

                      console.log(response);
                      testAPI();
                      data = { userID: response.authResponse.userID,
                               accessToken: response.authResponse.accessToken
                      };
                      $('#tumblr').show();
                      $('#splash').hide();
	  } else {
               // not_logged_in, show
               $('#tumblr').hide();
               $('#splash').show();
	  }
	 });
	  };

	  // Load the SDK Asynchronously
	  (function(d){
	     var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
	     if (d.getElementById(id)) {return;}
	     js = d.createElement('script'); js.id = id; js.async = true;
	     js.src = "//connect.facebook.net/en_US/all.js";
	     ref.parentNode.insertBefore(js, ref);
	   }(document));

	function login() {
	    FB.login(function(response) {
		    // connected
		if (response.authResponse) {

                     location.reload();
		} else {
		    // cancelled
		}
	    });
	}
function testAPI() {
    console.log('Welcome!  Fetching your information.... ');
    FB.api('/me', function(response) {
        console.log('Good to see you, ' + response.name + '.');
    });
    $('#stumbl').click( function(){
         $.post("/stumbl", data);
    });


}

</script>
    </head>

	<body >
	{& block content &}
		<div class="container">
			<header class="row">
				<div>
					<h1 id="banner">Stumblr!</h1>
                </div>
                <form name="form" method="POST" action="/stumbl">
                    <div class="btn-toolbar">
                        <div class="btn-group">
                                <button class="btn btn-primary" type="submit">Stumbl</button>
                            </form>
                        </div>

                        <div class="btn-group">
                            <button class="btn btn-success" type='button' id='like'>Like</button>
                            <button class="btn btn-danger" type='button' id='dislike'>Dislike</button>
                            <button class="btn btn-inverse" type='button' id='favorites'>Add to favorites</button>
                            <button class="btn btn-inverse" type='button' id='share'>Share with SendGrid</button>
                        </div>
                    </div>
                </form>

			</header>
        </div>
            <iframe id='tumblr' src='{{ url }}' frameBorder='0' sandbox="allow-forms allow-scripts" height="100%" width="100%"></iframe>
<div id="splash">
        <center>
          <h1>Welcome to Stumblr!</h1>
          <div class="btn btn-large btn-primary" type="button" id="fblogin">Login Using Facebook!</div>
        </center>
      </div>
		<script src="/static/js/vendor/jquery-1.8.2.min.js" type="text/javascript"></script>
		<script src="/static/js/bootstrap/bootstrap.js" type="text/javascript"></script>
{% endblock %}	
</body>
</html>
