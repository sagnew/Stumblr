<!DOCTYPE>
<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8">

        <title>Stumblr</title>

        <link rel="stylesheet" href="/static/css/bootstrap.css" type="text/css" media="screen" title="master" charset="utf-8">
        <link rel="stylesheet" href="/static/css/bootstrap-responsive.css" type="text/css" media="screen" title="master" charset="utf-8">
        <script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.5.1.min.js"></script>
        <script src="/static/jquery.js"></script>

        <div id="fb-root"></div>
        <script>
            // globals
            var data;

            // Additional JS functions here
            window.fbAsyncInit = function() {
                FB.init({
                    appId      : '290104991112550', // App ID
                    channelUrl : 'tranquil-earth-6918.herokuapp.com',  // Channel File

                    status     : true, // check login status
                    cookie     : true, // enable cookies to allow the server to access the session
                    xfbml      : true  // parse XFBML
                });

                // Additional init code here
                FB.getLoginStatus(function(response) {

                    // connected
                    if (response.status === 'connected') {

                        console.log(response);
                        testAPI();
                        data = { userID: response.authResponse.userID,
                            accessToken: response.authResponse.accessToken
                        };
                        $('#tumblr').show();
                        $('#splash').hide();
                    } else {
                        // not_logged_in, show
                        $('#tumblr').hide();
                        $('#splash').show();
                    }
                });
            };

            // Load the SDK Asynchronously
            (function(d){
                var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
                if (d.getElementById(id)) {return;}
                js = d.createElement('script'); js.id = id; js.async = true;
                js.src = "//connect.facebook.net/en_US/all.js";
                ref.parentNode.insertBefore(js, ref);
            }(document));

            function login() {
                FB.login(function(response) {
                    // connected
                    if (response.authResponse) {

                        location.reload();
                        } else {
                        // cancelled
                    }
                });
            }
            function testAPI() {
                console.log('Welcome!  Fetching your information.... ');
                FB.api('/me', function(response) {
                    console.log('Good to see you, ' + response.name + '.');
                });
                $('#stumbl').click( function(){
                    $.post("/stumbl", data);
                });

            }

            function submitForm()
            {
                document.form.action = document.pressed;
                data.url = $('#tumblr').val();
                $.post(document.pressed, data);
                return true;
            }
        </script>
    </head>

    <body >
        {% block content %}
        <form name="form" method="POST" onSubmit='return submitForm();' action="/stumbl">
            <div class="container">
                <header class="row">
                <div>
                    <h1 id="banner">Stumblr!</h1>
                </div>
                    <div class="btn-toolbar">
                        <div class="btn-group">
                            <button class="btn btn-primary" type="submit" id='stumbl' onClick='document.pressed=this.value' value='/stumbl'>Stumbl</button>
                        </div>

                        <div class="btn-group">
                            <button class="btn btn-success" type='submit' id='like' onClick='document.pressed=this.value;' value='/like'>Like</button>
                            <button class="btn btn-danger" type='submit' id='dislike 'onClick='document.pressed=this.value;' value='dislike'>Dislike</button>
                            <button class="btn btn-inverse" type='submit' id='favorites' onClick='document.pressed=this.value;' value='/favorites'>Add to favorites</button>
                        </div>
                    </div>

                    <input type='hidden' value = '{{ url }}' name='url'/>
                    <input type='hidden' value='{{ tag }}' name='tag'/>
                    <input type='hidden' value='{{ user }}'
                </header>
            </div>
            <iframe id='tumblr' src='{{ url }}' frameBorder='0' name='tumblr' sandbox="allow-forms allow-scripts" height="100%" width="100%"></iframe>
            <div id="splash">
                <center>
                    <h1>Welcome to Stumblr!</h1>
                    <div class="btn btn-large btn-primary" type="button" id="fblogin" name='fblogin'>Login Using Facebook!</div>
                </center>
            </div>
        </form>
        <script src="/static/js/vendor/jquery-1.8.2.min.js" type="text/javascript"></script>
        <script src="/static/js/bootstrap/bootstrap.js" type="text/javascript"></script>
        {% endblock %}
    </body>
</html>
